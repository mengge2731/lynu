<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wanhong.dao.ApplyInfoDao">

	<!-- user_info 所有查询列 -->
	<sql id="QUERY_COLUMN_LIST">
		<![CDATA[
			apply_id AS applyId
			,data_id AS dataId
			,apply_user_id AS applyUserId
			,pub_data_user_id AS pubDataUserId
			,apply_user_name AS applyUserName
			,apply_user_phone AS applyUserPhone
			,apply_desc AS applyDesc
			,apply_time AS applyTime
			,reply_time AS replyTime
			,status AS status
			,create_time AS createTime
			,update_time AS updateTime
		]]>
	</sql>

	<sql id="QUERY_LIMIT_CONDTION">
		<if test="startRow != null and startRow &gt;= 0 and pageSize != null and pageSize &gt; 0"><![CDATA[LIMIT #{startRow},#{pageSize}]]></if>
	</sql>

	<!--分页查询用户-->
	<select id="findMyData" parameterType="applyQuery" resultType="applyInfo">
		SELECT
			<include refid="QUERY_COLUMN_LIST"/>
		FROM
			apply_info u
		WHERE
			status = 0
		ORDER BY u.create_time ASC
		<include refid="QUERY_LIMIT_CONDTION"/>
	</select>

	<select id="findDataByPage" parameterType="applyQuery" resultType="applyInfo">
		SELECT
		<include refid="QUERY_COLUMN_LIST"/>
		FROM
		apply_info
		WHERE
		status = 0
		<include refid="QUERY_LIMIT_CONDTION"/>
	</select>



	
	<insert id="saveApplyInfo" parameterType="applyInfo" useGeneratedKeys="true" keyProperty="apply_id">
		INSERT IGNORE INTO apply_info
		(
		data_id
		,apply_user_id
		,pub_data_user_id
		,apply_user_name
		,apply_user_phone
		,apply_desc
		,apply_time
		,status
		,create_time
		,update_time
		)
		VALUES
		(
		#{dataId}
		,#{applyUserId}
		,#{pubDataUserId}
		,#{applyUserName}
		,#{applyUserPhone}
		,#{applyDesc}
		,now()
		,0
		,now()
		,now()
		)
	</insert>

</mapper>